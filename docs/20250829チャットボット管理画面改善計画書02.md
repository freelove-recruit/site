# チャットボット管理画面 完全引き継ぎ書（2025/08/29）

## 完了した作業
- 削除ボタン修正完了（モーダル方式採用）
- addBotMessage関数のSupabase連携完了
- 基本CRUD機能85%完成

## 次作業：選択肢チェーン機能実装

### 目的
既存のchatbot.tsxのグループ機能を管理画面で設定できるようにする

### 実装する機能
デフォルト：選択肢選択→Bot返答→選んだやつ除外して残り選択肢表示
特別設定：「特にない」等で次のチャット会話に進む

## 実装手順

### 1. 型定義の修正（chatbot-settings.tsx の4-5行目）

**修正前：**
```typescript
type SelectionType = 'normal' | 'input' | 'dropdown' | 'link' | 'auto-text';
```

**修正後：**
```typescript
type SelectionType = 'normal' | 'input' | 'dropdown' | 'link' | 'auto-text' | 'next';
```

### 2. Selection interfaceの修正（18-37行目あたり）

**追加する：**
```typescript
interface Selection {
  // 既存のプロパティ...
  goToNext?: boolean; // 次のチャット会話に進むフラグ
}
```

### 3. 選択肢タイプのプルダウン修正（850行目あたり）

**修正前：**
```typescript
{item.type === 'question' ? (
  <>
    <option value="normal">通常選択肢</option>
    <option value="input">入力ボックス</option>
    <option value="dropdown">プルダウン</option>
    <option value="link">リンクボタン</option>
  </>
) : (
  <option value="auto-text">自動文章用</option>
)}
```

**修正後：**
```typescript
{item.type === 'question' ? (
  <>
    <option value="normal">通常選択肢</option>
    <option value="input">入力ボックス</option>
    <option value="dropdown">プルダウン</option>
    <option value="link">リンクボタン</option>
    <option value="next">次のチャット会話へ進む</option>
  </>
) : (
  <option value="auto-text">自動文章用</option>
)}
```

### 4. updateSelection関数の対応確認（330行目あたり）

既存のupdateSelection関数で新しいフィールド(goToNext)も自動対応される。追加修正不要。

### 5. 動作テスト手順

1. チャット会話を作成
2. 選択肢追加
3. 選択肢タイプで「次のチャット会話へ進む」選択
4. 保存確認
5. データベースに正しく保存されているか確認

## 修正対象ファイル
- pages/admin/chatbot-settings.tsx

## 注意事項
- 'next'タイプの場合、詳細設定UI（入力ボックス設定等）は非表示にする
- Supabaseのselectionsテーブルにgo_to_nextカラム追加が必要な可能性あり
- 実際のchatbot.tsx側の対応は別途必要

チャットボット管理画面 引継書（2025年8月29日）
本日完了した作業
UI改善機能

チェックボックス選択式削除機能（個別削除ボタン廃止）
アコーディオン開閉を▶とタイトル部分のみに制限
ドラッグ機能を☰ハンドルのみに制限
ID表示機能（1. チャット会話: 2. 応募文生成:）
placeholder修正（初期文字が編集状態になってた問題解決）
「次のチャット会話へ進む」選択時の回答パターン非表示機能
並び替え時のID自動振り直し機能追加

技術修正

選択肢削除ボタンのレイアウト崩れ修正
構文エラー（padding重複）修正

検討中の応募文生成機能
現在の課題
機能名「応募文生成」が狭すぎる問題。他業種での汎用性を考える必要がある。
候補案

「定型文作成」← 最有力候補
「自動文書作成」
「お問い合わせ文作成」

どの業界でも問い合わせ文・申込み文として活用できる汎用的な名称が必要。
未決定事項

機能名の最終決定
既存chatbot.tsxの10×10×10パターンデータ移行するか
結合方法（スペース/改行/句読点）
生成数（1つ or 複数候補）
プレビュー機能の仕様

次回検討すべき点
この機能をどう設計するか、既存システムとの統合をどうするかの方針決定が必要。

担当者: Claude
次回作業: 応募文生成機能の仕様確定 → 実装