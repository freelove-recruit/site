# 動画埋め込みコード対応 実装計画書

## 📋 概要
**目的**: VimeoのURL方式から埋め込みコード方式に変更し、音声制御問題を解決する  
**効果**: YouTube、Vimeo、その他動画プラットフォーム全対応の汎用システム

---

## 🎯 解決する問題
1. **Vimeo純正ミュートボタンが押せない** → 埋め込み設定で事前解決
2. **カスタムミュートボタンが機能しない** → Vimeo側設定で解決
3. **YouTube対応** → 埋め込みコードで自動対応
4. **その他オプション問題** → Vimeo側で非表示設定可能

---

## 🔧 実装手順

### Phase 1: データベース変更
- **テーブル**: videos
- **変更内容**: url列 → embed_code列（TEXT型、長いコードに対応）
- **既存データ**: 手動移行またはスクリプト対応

### Phase 2: 管理画面修正（pages/admin/videos.tsx）
- **入力欄**: URL入力 → textarea（埋め込みコード用）
- **バリデーション**: iframe形式の検証追加
- **プレビュー**: 埋め込みコード表示

### Phase 3: 表示処理修正（pages/recruit.tsx）
- **削除**: getEmbedUrl関数（不要になる）
- **変更**: 埋め込みコードを直接dangerouslySetInnerHTMLで表示
- **サイズ調整**: videoRect計算との整合性確保

### Phase 4: セキュリティ対策
- **XSS防止**: iframe以外のタグ除去
- **URL検証**: 許可ドメイン（youtube.com、vimeo.com等）のみ
- **属性制限**: 危険な属性の除去

---

## 📁 修正対象ファイル
1. **Supabaseテーブル** - videos構造変更
2. **pages/admin/videos.tsx** - 管理画面
3. **pages/recruit.tsx** - 動画表示処理

---

## 🌟 期待される効果
- **音声制御**: Vimeo/YouTube側設定で完全制御
- **汎用性**: 全動画プラットフォーム対応
- **メンテナンス性**: プラットフォーム別処理が不要
- **機能拡張**: 字幕、開始時間等の詳細設定も可能

---

**作成日**: 2025年9月26日  
**次回作業**: Supabaseテーブル構造確認 → 管理画面ファイル確認