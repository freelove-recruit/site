# Next.js画像管理機能 引継ぎプロンプト

## 🎯 プロジェクト概要
求人ページの画像を管理画面からアップロード・変更できる機能を実装中。ファイルアップロード機能は完成済み、求人ページとの連動作業が残っている。

## 📋 現在の状況

### ✅ 完成済み機能
- **管理画面**: pages/admin/recruit-images.tsx（100%完成）
- **ファイルアップロード**: Supabase Storage連携（100%完成）
- **データベース保存**: site_imagesテーブル（100%完成）

### ❌ 未完成機能
- **求人ページ連動**: pages/recruit.tsx（0%未着手）
- **表示順序統一**: 管理画面と求人ページで逆順

## 🔧 技術構成
- **フレームワーク**: Next.js + TypeScript + Tailwind CSS
- **データベース**: Supabase（site_imagesテーブル）
- **ストレージ**: Supabase Storage（site-imagesバケット）

### site_imagesテーブル構造
```
- id (uuid, PRIMARY KEY)
- type (text) - 'fixed' または 'blog'
- name (text) - 画像の識別名
- image_url (text) - Supabase StorageのURL
- link_url (text) - クリック時のリンク先
- sort_order (integer) - 表示順序
- created_at (timestamp)
```

## 🚧 次回作業内容

### 1. recruit.tsx修正（必須）
**現在の問題**: 静的な画像URLがハードコードされている
**修正方法**: Supabaseから動的にデータ取得

```typescript
// 追加が必要な処理
const [siteImages, setSiteImages] = useState([]);

useEffect(() => {
  const fetchImages = async () => {
    const { data } = await supabase
      .from('site_images')
      .select('*')
      .order('sort_order', { ascending: true });
    setSiteImages(data || []);
  };
  fetchImages();
}, []);
```

### 2. 表示順序修正（必須）
**現在の問題**: 管理画面と求人ページで表示順が逆
**修正方法**: blogタイプをsort_order順で表示

### 3. 静的データ削除（必須）
現在recruit.tsxにハードコードされている画像URLを全て削除し、siteImagesから取得したデータに置き換え

## ⚠️ 重要な技術情報

### 解決済みエラー
1. **404エラー**: Supabase Storage権限設定で解決済み
2. **403エラー**: RLSポリシー追加で解決済み
3. **400エラー**: titleカラム不存在エラー→nameカラムに統一で解決済み

### 動作確認済み機能
- ファイル選択→Supabase Storageアップロード→URL自動取得→プレビュー表示
- 管理画面でのデータ保存→site_imagesテーブル反映
- 画像の追加・削除・並び替え

## 📝 作業手順
1. **recruit.tsxファイル確認**: 現在の画像表示部分を特定
2. **Supabase連携追加**: useEffectでデータ取得処理追加
3. **静的URL削除**: ハードコードされた画像URLを動的データに置き換え
4. **表示順序修正**: sort_order基準の表示に変更
5. **動作テスト**: 管理画面→求人ページ反映確認

## 🎯 完成目標
管理画面で画像をアップロード→求人ページに即座に反映される状態にする

## 👤 ユーザー特性
- 技術的な質問には簡潔に回答を求める
- 長い説明や丁寧語は不要
- エラーが発生したら具体的な修正コードを提示
- 作業効率を最優先