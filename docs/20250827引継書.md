# チャットボットSupabase連携 引継書（2025年8月27日）

## ⚠️ 前作業者の問題点

**完全に混乱して時間を無駄にした経緯：**
- 既存テーブル活用 ⇄ 新規作成 ⇄ 1テーブル統合 ⇄ 3テーブル分割を迷走
- 一度作成した `chat_themes` テーブルを無駄に削除
- 論理的思考ができておらず、場当たり的な提案を連発

## 📋 現在の状況

### **完成済み**
- **チャットボット本体** (`pages/chatbot.tsx`) - 完全動作
- **管理画面UI** (`pages/admin/chatbot-settings.tsx`) - UI完成、モックデータで動作
- **Supabaseプロジェクト** - 接続設定済み

### **既存Supabaseテーブル**
- `bot_questions` (Unrestricted)
- `bot_responses` (Unrestricted) 
- `application_templates` (Unrestricted)
- `videos` (Unrestricted) - 動画管理で使用中

### **チャットボット.tsxの実データ**
```typescript
// 不安要素テーマ（4種類）
uneaseThemes: [
  { id: "week", label: "週◯日くらいしか入れないかも", pulldown: true, replies: {...} },
  { id: "mensetsu", label: "面接って緊張する", replies: [...] },
  { id: "yurui", label: "ゆるい雰囲気がいいな", replies: [...] },
  { id: "kake", label: "掛け持ちでもいける？", replies: [...] }
]

// その他テーマ（6種類）  
otherThemes: [
  { id: "mikei", label: "未経験でも大丈夫？", replies: [...] },
  { id: "nichibara", label: "日払いってほんと？", replies: [...] },
  { id: "bale", label: "身バレしない？", replies: [...] },
  { id: "tikoku", label: "遅刻・休みって厳しい？", replies: [...] },
  { id: "hanashidake", label: "とりあえず話だけ聞きたい", replies: [...] },
  { id: "hito", label: "人見知りだけど大丈夫？", replies: [...] }
]

// 応募文パターン（各10種類）
applyAges: [10パターン]
applyStylesText: [10パターン]
applyReasonsText: [10パターン]
finishComments: [10パターン]

// 選択肢
ages: ["18〜22歳", "23〜29歳", "30代〜"]
applyStyles: ["がっつり稼ぎたい", "本業と両立しながら働きたい", "短期・体験から始めたい"]
applyReasons: ["収入を増やしたい", "安心して始めたい", "自分らしく働きたい", "誰にも知られずこっそりやりたい", "この中にない"]
```

## 🎯 必要な作業

### **優先度1: データベース設計**
既存テーブルの構造確認（`bot_questions`, `bot_responses`, `application_templates`）とchatbot.tsxデータの適合性検証。

### **優先度2: データ移行方法決定**
- 既存テーブル活用 or 新規テーブル作成の最終判断
- データ投入方法の確定（SQL直接入力 or 管理画面経由）

### **優先度3: 管理画面連携**
- Supabaseからの読み込み機能実装
- 管理画面での編集→DB保存機能実装

### **優先度4: チャットボット本体の動的化**
- ハードコーデッドデータをSupabase参照に変更

## 🔧 技術的な課題

### **複雑なデータ構造**
- 週○日テーマのプルダウン選択肢（1-4日）ごとに異なる応答パターン
- 各テーマに3つの応答パターンが複数セット存在
- 応募文生成の複雑な組み合わせロジック

### **文字化け問題**
chatbot.tsxのデータが一部文字化けしており、正しいデータの抽出・整理が必要。

## 📂 ファイル状況

### **正常動作中**
- `pages/chatbot.tsx` - フル機能チャットボット（ハードコーデッドデータ）
- `pages/admin/videos.tsx` - 動画管理（Supabase完全連携済み）
- `pages/admin/chatbot-settings.tsx` - チャット設定UI（モックデータ）

### **接続設定**
- `lib/supabase.ts` - 接続設定済み

## ⚠️ 作業時の注意点

1. **既存の動画管理機能に影響を与えない**
2. **チャットボット本体の動作を壊さない**
3. **データベース設計は慎重に行う**（後からの構造変更は困難）

## 🚀 次回作業者への提案

### **推奨アプローチ**
1. **まず既存テーブル構造を詳細確認**
2. **データ適合性を検証**
3. **適合しない場合のみ新テーブル作成**
4. **段階的にデータ移行・連携実装**

### **避けるべき行動**
- 場当たり的な提案
- 複数の選択肢を同時に検討
- 作業途中でのアプローチ変更
- 時間制限を理由にした妥協

---

**作業開始前に必ずデータベース設計を確定すること**

**担当者:** Claude Sonnet 4（失格）  
**作成日:** 2025年8月27日  
**状況:** DB連携未着手、設計段階で混乱により中断