# 求人ページ画像アップロード機能 進捗まとめ

## ✅ 完了した作業

### 1. Supabase Storage設定
- バケット「site-images」作成完了
- 公開設定（Public）有効化
- Row Level Security（RLS）ポリシー設定完了
  - SELECT操作許可ポリシー
  - INSERT操作許可ポリシー
  - 全操作許可ポリシー

### 2. ファイルアップロード機能実装
- pages/admin/recruit-images.tsxのhandleImageUpload関数修正
- ファイル選択→Supabase Storageアップロード→URL自動取得→プレビュー表示の流れ完成
- console.logでのデバッグ機能追加

### 3. データベース連携
- handleAddBlog関数のテーブル構造エラー修正
  - `title`カラム削除（存在しないため）
  - `name`カラムに統一
- Supabase site_imagesテーブルへの正常なデータ保存確認

### 4. 管理画面での動作確認
- ファイル選択機能：正常動作
- 画像プレビュー機能：正常動作
- データベース保存機能：正常動作
- 管理画面での表示更新：正常動作

## ❌ 未完了の作業

### 1. 求人ページとの連動
**現在の問題：**
- 求人ページ（pages/recruit.tsx）が静的データを表示している
- 管理画面でアップロードした画像が求人ページに反映されない

**必要な作業：**
- recruit.tsxにSupabaseからのデータ取得機能追加
- 静的な画像URLをSupabase連動に変更

### 2. 表示順序の修正
**現在の問題：**
- 管理画面での並び順と求人ページでの表示順が逆
- 黒いバナー：管理画面では下、求人ページでは上

**必要な作業：**
- recruit.tsxでの表示順序をsort_order基準に修正
- 管理画面と求人ページの表示順統一

## 🎯 次回作業予定

### Phase 1: recruit.tsx修正
1. **Supabase接続追加**
   - useEffectでsiteImagesデータ取得
   - 画像表示部分を動的データに変更

2. **静的データ削除**
   - ハードコードされた画像URL削除
   - Supabaseから取得したデータに置き換え

3. **表示順序修正**
   - blogタイプの画像をsort_order順で表示
   - 管理画面と同じ並び順に統一

### Phase 2: 動作テスト
1. **管理画面→求人ページ連動確認**
   - 画像アップロード→求人ページ反映確認
   - 並び替え→求人ページ反映確認
   - 削除→求人ページ反映確認

2. **最終調整**
   - 画像サイズ・レイアウト調整
   - エラーハンドリング追加

## 📋 現在の完成度
- **管理画面機能**: 100%完成
- **ファイルアップロード**: 100%完成  
- **データベース連携**: 100%完成
- **求人ページ連動**: 0%未着手
- **全体完成度**: 約70%

## 🔧 技術的な解決済み問題
1. **404エラー**: Supabase Storage権限設定で解決
2. **403エラー**: RLSポリシー追加で解決
3. **400エラー**: テーブル構造不一致修正で解決
4. **データ保存失敗**: titleカラム削除で解決

次回はrecruit.tsxの修正から開始予定です。