# 応募文生成機能 完全仕様書

## 概要

既存の管理画面で「応募文生成を作成」を選んだ時の機能詳細

---

## 応募文生成アイテムの選択肢タイプ

### 利用可能な選択肢タイプ
- **入力ボックス**: 名前入力等
- **記録**: 選択内容を後でまとめ出力用に記録
- **組み合わせ文章**: 文章パーツからランダム生成
- **まとめ出力**: 記録した選択内容を黒枠コピー表示

### 1. 記録タイプ
```
選択肢2: [記録 ▼]
├ ボット文章: "年代を教えてください"
├ 記録項目名: [項目名を記入] (placeholder、クリックで消えて入力可能)
├ 選択肢設定:
│ ├ 18-22歳 [削除]
│ ├ 30代 [削除]
│ └ [+ 選択肢追加]
```

### 2. 組み合わせ文章タイプ
```
選択肢4: [組み合わせ文章 ▼]
├ ボット文章: "応募文を3つ作りました" (入力任意)
├ 項目名: [応募文] (まとめ出力用)
├ 文章パーツ管理:
│ ├ カテゴリ1
│ │ ├ パーツ1: [textarea] [削除]
│ │ ├ パーツ2: [textarea] [削除]
│ │ └ [+ パーツ追加] (最大10個)
│ ├ カテゴリ2 (同じ構造)
│ ├ カテゴリ3 (同じ構造)
│ └ [プレビュー生成] ボタン
├ 再生成設定:
│ ├ ☑ 再生成機能有効
│ ├ ボタン文字: [もう一回作成]
│ └ 制限回数: [無制限 ▼]
```

#### 組み合わせ生成ロジック
- 各カテゴリから3個ずつランダム選択
- 組み合わせて3パターン作成
- ユーザーが1つ選択
- 再生成ボタンで新たな3パターン作成

### 3. まとめ出力タイプ
```
選択肢6: [まとめ出力 ▼]
├ ボット文章: "内容を確認してコピーしてください"
├ 出力対象選択:
│ ├ ☑ 名前
│ ├ ☑ 年代
│ ├ ☑ 働き方
│ ├ ☑ 理由
│ ├ ☑ 応募文
│ └ ☑ 面接希望
├ 出力フォーマット: [textarea]
│ 例: "名前: {名前}\n年代: {年代}\n応募文: {応募文}"
```

---

## 実装する応募文生成フロー例

```
▼ 1. [求人応募フロー] ☑
   └ 選択肢1: [入力ボックス]
       └ ボット文章「お名前を教えてください（ニックネームOK）」
   └ 選択肢2: [記録] 
       └ ボット文章「年代を教えてください」
       └ 記録項目名「年代」
       └ 18-22歳、30代、40代
   └ 選択肢3: [記録]
       └ ボット文章「働き方のイメージはどれが近い？」 
       └ 記録項目名「働き方」
       └ がっつり稼ぎたい、本業と両立、短期体験
   └ 選択肢4: [記録]
       └ ボット文章「応募理由を教えてください」
       └ 記録項目名「理由」
       └ 収入を増やしたい、安心して始めたい等
   └ 選択肢5: [組み合わせ文章]
       └ ボット文章なし
       └ 年代用パーツ10個、働き方用パーツ10個、理由用パーツ10個
       └ 再生成機能: ☑有効「もう一回作成」
   └ 選択肢6: [記録]
       └ ボット文章「面接希望時間帯を教えて」
       └ 記録項目名「面接希望」
       └ 平日午前、平日午後等
   └ 選択肢7: [まとめ出力]
       └ ボット文章「この内容をコピーしてご応募ください」
       └ 出力対象: 名前、年代、働き方、理由、応募文、面接希望
```

---

## データベース設計

### 新規テーブル
```sql
-- 応募文パーツ
application_parts (
  id uuid PRIMARY KEY,
  item_id uuid references chat_items(id),
  selection_id uuid references selections(id),
  category_index integer, -- 1,2,3 (カテゴリ1,2,3)
  text text,
  order_index integer
);

-- まとめ出力設定
output_settings (
  id uuid PRIMARY KEY,
  selection_id uuid references selections(id),
  target_fields jsonb, -- ["name","age","style"]
  format_template text
);
```

---

## UI実装ポイント

### 選択肢タイプによる表示切り替え
- **通常選択肢**: ボット文章 + 選択肢設定 + 回答パターン
- **記録**: ボット文章 + 記録項目名 + 選択肢設定（回答パターンなし）
- **組み合わせ文章**: 文章パーツ管理 + 再生成設定（ボット文章なし）
- **まとめ出力**: ボット文章 + 出力設定

### ユーザー選択結果の表示
- 固定形式: `↪ 選択したテキスト`（グレー色）
- コード内で統一実装、管理画面での設定項目なし

### プレビュー機能
- 組み合わせ文章でプレビューボタン押下
- モーダルで3パターンの生成例を表示
- 「もう一度生成」ボタンで再生成

---

## 技術仕様

### 使用技術
- Next.js + TypeScript + Tailwind CSS
- Supabase（既存テーブル + 新規テーブル）
- 既存chatbot-settings.tsxを拡張

### 実装順序
1. モーダル削除（即座作成に変更）
2. 選択肢タイプに「記録」「組み合わせ文章」「まとめ出力」追加
3. 各タイプ専用UI実装
4. Supabase新規テーブル作成・連携
5. プレビュー機能実装

### ファイル構成
- `pages/admin/chatbot-settings.tsx`: メイン管理画面
- 新規Supabaseテーブル: application_parts, output_settings
- 既存テーブル活用: chat_items, selections, bot_messages

---

以上が完全仕様や。これで実装可能な構造になってる。