# チャットボット設定 設計書

## 📋 全体構成

### **管理画面タブ構成**
```
[TOP] [動画管理] [チャットボット設定]
```
既存の質問管理・応答管理・テンプレートを削除して「チャットボット設定」1つに統合

### **チャットボット設定ページ**
- 1ページで全機能を統合管理
- アコーディオン形式で開閉表示

### **新規作成方式**
```
[+ 新規作成] ← クリック時にモーダル表示
┌─ どの機能を作成しますか？ ─┐
│ ○ 質問・回答を作成          │
│ ○ 自動文章生成を作成        │
│                             │
│     [OK] [キャンセル]        │
└───────────────────────┘
```

### **表示・並び替え**
- 作成したアイテムは上から順番に表示
- ドラッグ&ドロップで全体の並び替え可能
- チャットの流れ順に表示される

---

## 🔧 機能別詳細説明

### **1. 質問・回答管理とは**
**目的**: ユーザーとBotの1対1のやり取りを管理
**動作**: ユーザーが選択/入力 → Botが即座に回答して次に進む

**選択肢の種類説明:**
- **通常選択肢**: ボタンをクリックして選ぶ（例: 週1日/週2日/週3日）
- **入力ボックス**: テキストを自由入力（例: 名前、メールアドレス）
- **プルダウン**: ドロップダウンから選択（例: 都道府県選択）
- **リンクボタン**: 電話・メール・URLに直接飛ぶボタン

### **2. 自動文章作成とは**
**目的**: ユーザーの選択内容から応募文などを自動生成
**動作**: 複数の選択肢の回答を組み合わせて文章を作成

**具体例:**
```
管理画面で設定:
選択肢1「年代」
├ 20代 → パターン1「はじめまして」
├ 30代 → パターン2「こんにちは」

選択肢2「働き方」  
├ がっつり → パターン1「しっかり稼ぎたい」
├ 両立 → パターン2「無理なく働きたい」

ユーザーが「20代」「がっつり」選択
↓
自動生成「はじめまして。しっかり稼ぎたいです。」
```

**組み合わせルール設定:**
- ☑チェックした選択肢からランダムで1つずつ選択
- 結合方法でつなげ方を指定（スペース/改行/連結）
- プレビューで生成例を事前確認可能

---

## 🎯 チャットボットの動作概要

### **基本的な流れ**
1. **Botが質問** → **ユーザーが選択/入力** → **Botが回答**
2. 複数の質問を順番に進める
3. 最後に収集した情報で自動的に応募文を生成

### **実際のチャット例**
```
Bot: 「働く頻度はどれくらいがいいですか？」
User: [週2日くらい] ← 選択
Bot: 「週2日なら無理なく続けられますね！」

Bot: 「お名前を教えてください」  
User: [田中太郎] ← 入力
Bot: 「ありがとうございます！」

Bot: 「年代を教えてください」
User: [20代] ← 選択（自動文章生成用）

Bot: 「働き方の希望は？」
User: [がっつり稼ぎたい] ← 選択（自動文章生成用）

Bot: 「応募文を3つ作成しました！」
1) はじめまして、田中と申します。がっつり働いて稼ぎたいです。
2) こんにちは。しっかりと働かせていただきたく...
3) 応募させていただきます。収入アップを目指して...
```

---

## 🎯 各機能詳細

### **1. 質問・回答管理**
```
▼ 質問・回答: [タイトル名] [削除]
├ 有効/無効設定（無効時はグレー表示）
├ ボット文章編集
├ サブ文言追加（チェックボックスで有効/無効）
├ 選択肢管理（ドラッグ&ドロップ並び替え）
│ ├ 選択肢タイプ: 通常/入力ボックス/プルダウン/リンク/自動文章用
│ ├ 入力ボックス: プレースホルダー/必須/最大文字数/ボタン文字
│ ├ プルダウン: 選択肢複数設定
│ ├ リンク: 電話/URL/メール設定（メール件名は空欄可）
│ ├ 自動文章用: 文章パターン管理（後で組み合わせ対象）
│ └ 回答パターン管理（ドラッグ&ドロップ並び替え）
└ [選択肢追加]
```

### **2. 自動文章作成**
```
▼ 自動文章: [タイトル名] [削除]
├ 有効/無効設定（無効時はグレー表示）  
├ ボット文章編集
├ サブ文言追加（チェックボックスで有効/無効）
│ ├ サブ文言内容編集
│ └ 文字色設定（赤/灰/青）
├ 選択肢と文章パターン管理
│ ├ 選択肢1: [名前編集可能]
│ │ ├ パターン1: [テキストエリア]（ドラッグ&ドロップ並び替え）
│ │ ├ パターン2: [テキストエリア]（ドラッグ&ドロップ並び替え）
│ │ └ [+ パターン追加]
│ ├ 選択肢2: [名前編集可能]
│ │ ├ パターン1: [テキストエリア]（ドラッグ&ドロップ並び替え）
│ │ └ [+ パターン追加]
│ └ [+ 選択肢追加]
├ 組み合わせルール設定
│ ├ ☑ 選択肢1からランダム選択
│ ├ ☑ 選択肢2からランダム選択
│ └ 結合方法: [▼スペース区切り ▼改行区切り ▼そのまま連結]
└ プレビュー: [生成例を表示]
```

---

## 📱 実装時の注意点

### **データベース構造**
- 各アイテムに順序番号を保持
- 選択肢と回答パターンも順序管理
- 有効/無効フラグでグレー表示制御

### **ドラッグ&ドロップ実装**
- react-beautiful-dnd等のライブラリ使用推奨
- 3階層すべてでドラッグ&ドロップ対応必須

### **モーダル実装**
- 選択肢追加時と新規作成時にモーダル表示
- ラジオボタンで単一選択
- OKボタンで選択確定

### **自動文章生成ロジック**
- ユーザーの選択内容を変数として保持
- 組み合わせルールに従ってランダム選択
- プレビュー機能で事前確認可能

### **サブ文言機能**  
- チェックボックスでON/OFF切り替え
- 文字色は赤/灰/青から選択
- メイン文章の下に小さく表示

---

### **3階層ドラッグ&ドロップ**
1. 全体アイテム並び替え
2. 選択肢並び替え  
3. 回答パターン並び替え

### **アコーディオン表示**
- 全アイテム開閉可能
- 選択肢・回答パターンも個別開閉可能

### **リンク設定**
- 電話: 電話番号入力
- URL: URL入力 + 新規タブ設定
- メール: アドレス入力 + 件名入力（空欄可）

### **サブ文言設定**
- チェックボックスで追加/削除
- 文字色選択（赤/灰/青）
- メイン文章の下に小さく表示

---

## 📱 技術仕様

### **使用技術**
- Next.js + TypeScript + Tailwind CSS
- Supabase（データベース）
- ドラッグ&ドロップライブラリ

### **データ構造**
- 階層構造でのJSON管理
- 順序保持機能
- リアルタイム保存

---

**作成日**: 2025年8月21日  
**バージョン**: 1.0